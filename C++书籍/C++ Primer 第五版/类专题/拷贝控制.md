# 概述

- 拷贝和移动构造函数：

  定义了：用同类型的对象，初始化本对象的行为

- 拷贝和移动赋值运算符：

  定义了：用同类型的对象，赋予本对象的行为。



- 一个类，总是隐式，或显式的凑齐这五个函数。



# 拷贝构造函数(copy constructor)

```C++
class Foo{
	FOO();
    FOO(const FOO&);	// 拷贝构造函数
}
```





## 编译器的默认提供

- 什么时候提供：

  在没有显式定义拷贝构造函数时

- 默认提供的，会做些什么：

  - 对类类型的成员，使用拷贝构造函数来拷贝
  - 内置类型：直接拷贝
  - 数组：会依次拷贝数组的每个元素



## 拷贝初始化

```C++
string dots(10, '.');	// 直接初始化
string s(dots);			// 直接初始化

string s2 = dots;					// 拷贝初始化
string null_book = "9-999-9999";	// 拷贝初始化
string nines = string(100,	'9');	// 拷贝初始化
```



当我们使用拷贝初始化时，我们要求编译器，将右侧运算对象，拷贝到正在创建的对象。

<font color="red">拷贝初始化，使用<u>拷贝构造函数</u> 或 <u>移动构造函数</u>来完成</font>。



拷贝初始化发生的情况：

- 使用`=`，定义对象
- 将一个对象作为实参，传递给非引用的实参
- 从一个返回类型为为非引用类型的函数，返回一个对象
- 用`{}`初始化数组或类





# 移动构造函数(move constructor)





# 拷贝赋值运算符(copy-assignment operator)

```C++
class Foo{
	FOO();
    FOO& operator=(const FOO&);	// 拷贝构造函数
}
```





## 编译器的默认提供

- 什么时候编译器会提供：

  未显式定义时。

- 默认拷贝赋值元素符重载，会做：

  - 内置类型：直接赋值
  - 类类型：直接赋值，相当于调用了该对象所属类的operator=()



# 移动赋值运算符(move-assignment operator)





# 析构函数(destructor)

在析构函数中：

1. 先指向析构函数的函数体
2. 再按类中出现的顺序，逆序销毁



无论何时一个对象被销毁，都会自动调用其析构函数：

- 变量在离开其作用域时被销毁
- 当一个对象被销毁时，其成员被销毁
- 容器（无论是标准库容器或数组）被销毁时，其元素被销毁
- 对于动态分配的对象，对它的指针应用delete时
- **临时对象，创建它的完整表达式结束**



# 阻止拷贝=delete

将**拷贝构造函数**和**拷贝赋值运算符**，定义删除的函数。

```C++
class FOO{
	FOO() = default;
    FOO(const FOO&) = delete;
    FOO& operator=(const FOO&) = delete;
}
```



> 事实上，任何函数都可以定义为`=delete`